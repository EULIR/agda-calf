<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Examples.Gcd.Clocked</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Keyword">module</a> <a id="8" href="Examples.Gcd.Clocked.html" class="Module">Examples.Gcd.Clocked</a> <a id="29" class="Keyword">where</a>

<a id="36" class="Keyword">open</a> <a id="41" class="Keyword">import</a> <a id="48" href="Calf.CostMonoid.html" class="Module">Calf.CostMonoid</a>
<a id="64" class="Keyword">import</a> <a id="71" href="Calf.CostMonoids.html" class="Module">Calf.CostMonoids</a> <a id="88" class="Symbol">as</a> <a id="91" class="Module">CM</a>

<a id="95" class="Keyword">open</a> <a id="100" class="Keyword">import</a> <a id="107" href="Calf.html" class="Module">Calf</a> <a id="112" href="Calf.CostMonoids.html#293" class="Function">CM.ℕ-CostMonoid</a>
<a id="128" class="Keyword">open</a> <a id="133" class="Keyword">import</a> <a id="140" href="Calf.Types.Nat.html" class="Module">Calf.Types.Nat</a>
<a id="155" class="Keyword">open</a> <a id="160" class="Keyword">import</a> <a id="167" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="176" class="Keyword">using</a> <a id="182" class="Symbol">(</a><a id="183" href="Data.Nat.Base.html#1544" class="Datatype Operator">_≤_</a><a id="186" class="Symbol">;</a> <a id="188" href="Data.Nat.Base.html#1567" class="InductiveConstructor">z≤n</a><a id="191" class="Symbol">)</a>
<a id="193" class="Keyword">open</a> <a id="198" class="Keyword">import</a> <a id="205" href="Calf.Types.Unit.html" class="Module">Calf.Types.Unit</a>
<a id="221" class="Keyword">open</a> <a id="226" class="Keyword">import</a> <a id="233" href="Calf.Types.Bounded.html" class="Module">Calf.Types.Bounded</a> <a id="252" href="Calf.CostMonoids.html#293" class="Function">CM.ℕ-CostMonoid</a>
<a id="268" class="Keyword">open</a> <a id="273" class="Keyword">import</a> <a id="280" href="Calf.Types.BoundedFunction.html" class="Module">Calf.Types.BoundedFunction</a> <a id="307" href="Calf.CostMonoids.html#293" class="Function">CM.ℕ-CostMonoid</a>

<a id="324" class="Keyword">open</a> <a id="329" class="Keyword">import</a> <a id="336" href="Data.Nat.DivMod.html" class="Module">Data.Nat.DivMod</a>
<a id="352" class="Keyword">open</a> <a id="357" class="Keyword">import</a> <a id="364" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="402" class="Symbol">as</a> <a id="405" class="Module">P</a>
<a id="407" class="Keyword">open</a> <a id="412" class="Keyword">import</a> <a id="419" href="Data.Product.html" class="Module">Data.Product</a>

<a id="433" class="Keyword">open</a> <a id="438" class="Keyword">import</a> <a id="445" href="Examples.Gcd.Euclid.html" class="Module">Examples.Gcd.Euclid</a>

<a id="466" class="Comment">{- Alternative definition of gcd with an explicit clock parameter.
   It is easier to see the computational behavior of the code in this version:
   1) when the clock is nonzero: the algorithm proceeds as normal
   2) clock is zero: algorithm terminates
   Crucially, if the recursor is by-name, then the value of the clock does not
   affect asymptotic behavior of the algorithm.
   Two things one can do in calf:
   1) give a good characterization of the clock in terms of the input by refining the raw recurrence (see Refine.agda)
   2) give a good characterization for of the clock for running the code; this usually
   means finding a clock computation that is simpler to compute
   than the &quot;good&quot; upperbound. For gcd, one can reuse the argument as the clock (see Spec.agda)
-}</a>
<a id="gcd/clocked"></a><a id="1250" href="Examples.Gcd.Clocked.html#1250" class="Function">gcd/clocked</a> <a id="1262" class="Symbol">:</a> <a id="1264" href="Calf.Metalanguage.html#506" class="Function">cmp</a> <a id="1268" class="Symbol">(</a><a id="1269" href="Calf.Metalanguage.html#1035" class="Function">Π</a> <a id="1271" href="Calf.Types.Nat.html#164" class="Function">nat</a> <a id="1275" class="Symbol">λ</a> <a id="1277" href="Examples.Gcd.Clocked.html#1277" class="Bound">_</a> <a id="1279" class="Symbol">→</a> <a id="1281" href="Calf.Metalanguage.html#1035" class="Function">Π</a> <a id="1283" href="Examples.Gcd.Euclid.html#1349" class="Function">gcd/i</a> <a id="1289" class="Symbol">λ</a> <a id="1291" href="Examples.Gcd.Clocked.html#1291" class="Bound">_</a> <a id="1293" class="Symbol">→</a> <a id="1295" href="Calf.Metalanguage.html#311" class="Function">F</a> <a id="1297" href="Calf.Types.Nat.html#164" class="Function">nat</a><a id="1300" class="Symbol">)</a>
<a id="1302" href="Examples.Gcd.Clocked.html#1250" class="Function">gcd/clocked</a> <a id="1314" href="Agda.Builtin.Nat.html#204" class="InductiveConstructor">zero</a> <a id="1319" class="Symbol">(</a><a id="1320" href="Examples.Gcd.Clocked.html#1320" class="Bound">x</a> <a id="1322" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1324" href="Examples.Gcd.Clocked.html#1324" class="Bound">y</a> <a id="1326" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1328" href="Examples.Gcd.Clocked.html#1328" class="Bound">h</a><a id="1329" class="Symbol">)</a> <a id="1331" class="Symbol">=</a> <a id="1333" href="Calf.Metalanguage.html#554" class="Function">ret</a> <a id="1337" href="Examples.Gcd.Clocked.html#1320" class="Bound">x</a>
<a id="1339" href="Examples.Gcd.Clocked.html#1250" class="Function">gcd/clocked</a> <a id="1351" class="Symbol">(</a><a id="1352" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1356" href="Examples.Gcd.Clocked.html#1356" class="Bound">k</a><a id="1357" class="Symbol">)</a> <a id="1359" class="Symbol">(</a><a id="1360" href="Examples.Gcd.Clocked.html#1360" class="Bound">x</a> <a id="1362" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1364" class="Number">0</a> <a id="1366" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1368" href="Examples.Gcd.Clocked.html#1368" class="Bound">h</a><a id="1369" class="Symbol">)</a> <a id="1371" class="Symbol">=</a>  <a id="1374" href="Calf.Metalanguage.html#554" class="Function">ret</a> <a id="1378" class="Symbol">{</a><a id="1379" href="Calf.Types.Nat.html#164" class="Function">nat</a><a id="1382" class="Symbol">}</a> <a id="1384" href="Examples.Gcd.Clocked.html#1360" class="Bound">x</a>
<a id="1386" href="Examples.Gcd.Clocked.html#1250" class="Function">gcd/clocked</a> <a id="1398" class="Symbol">(</a><a id="1399" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1403" href="Examples.Gcd.Clocked.html#1403" class="Bound">k</a><a id="1404" class="Symbol">)</a> <a id="1406" class="Symbol">(</a><a id="1407" href="Examples.Gcd.Clocked.html#1407" class="Bound">x</a> <a id="1409" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1411" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1415" href="Examples.Gcd.Clocked.html#1415" class="Bound">y</a> <a id="1417" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1419" href="Examples.Gcd.Clocked.html#1419" class="Bound">h</a><a id="1420" class="Symbol">)</a> <a id="1422" class="Symbol">=</a>
  <a id="1426" href="Calf.Metalanguage.html#588" class="Function">bind</a> <a id="1431" class="Symbol">{</a><a id="1432" href="Examples.Gcd.Euclid.html#762" class="Function">mod-tp</a> <a id="1439" href="Examples.Gcd.Clocked.html#1407" class="Bound">x</a> <a id="1441" class="Symbol">(</a><a id="1442" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1446" href="Examples.Gcd.Clocked.html#1415" class="Bound">y</a><a id="1447" class="Symbol">)</a> <a id="1449" href="Calf.Types.Unit.html#233" class="InductiveConstructor">triv</a><a id="1453" class="Symbol">}</a> <a id="1455" class="Symbol">(</a><a id="1456" href="Calf.Metalanguage.html#311" class="Function">F</a> <a id="1458" href="Calf.Types.Nat.html#164" class="Function">nat</a><a id="1461" class="Symbol">)</a> <a id="1463" class="Symbol">(</a><a id="1464" href="Examples.Gcd.Euclid.html#913" class="Function">mod</a> <a id="1468" href="Examples.Gcd.Clocked.html#1407" class="Bound">x</a> <a id="1470" class="Symbol">(</a><a id="1471" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1475" href="Examples.Gcd.Clocked.html#1415" class="Bound">y</a><a id="1476" class="Symbol">)</a> <a id="1478" href="Calf.Types.Unit.html#233" class="InductiveConstructor">triv</a><a id="1482" class="Symbol">)</a>
  <a id="1486" class="Symbol">λ</a> <a id="1488" class="Symbol">{</a> <a id="1490" class="Symbol">(</a><a id="1491" href="Examples.Gcd.Clocked.html#1491" class="Bound">z</a> <a id="1493" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1495" href="Examples.Gcd.Clocked.html#1495" class="Bound">eqn2</a><a id="1499" class="Symbol">)</a> <a id="1501" class="Symbol">→</a>
  <a id="1505" class="Keyword">let</a> <a id="1509" href="Examples.Gcd.Clocked.html#1509" class="Bound">h2</a> <a id="1512" class="Symbol">=</a> <a id="1514" href="Relation.Binary.PropositionalEquality.Core.html#1803" class="Function">P.subst</a> <a id="1522" class="Symbol">(λ</a> <a id="1525" href="Examples.Gcd.Clocked.html#1525" class="Bound">k</a> <a id="1527" class="Symbol">→</a> <a id="1529" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1533" href="Examples.Gcd.Clocked.html#1525" class="Bound">k</a> <a id="1535" href="Data.Nat.Base.html#1544" class="Datatype Operator">≤</a> <a id="1537" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1541" href="Examples.Gcd.Clocked.html#1415" class="Bound">y</a><a id="1542" class="Symbol">)</a> <a id="1544" class="Symbol">(</a><a id="1545" href="Relation.Binary.PropositionalEquality.Core.html#1707" class="Function">P.sym</a> <a id="1551" href="Examples.Gcd.Clocked.html#1495" class="Bound">eqn2</a><a id="1555" class="Symbol">)</a> <a id="1557" class="Symbol">(</a><a id="1558" href="Data.Nat.DivMod.html#3989" class="Function">m%n&lt;n</a> <a id="1564" href="Examples.Gcd.Clocked.html#1407" class="Bound">x</a> <a id="1566" class="Symbol">_)</a> <a id="1569" class="Keyword">in</a>
  <a id="1574" href="Examples.Gcd.Clocked.html#1250" class="Function">gcd/clocked</a> <a id="1586" href="Examples.Gcd.Clocked.html#1403" class="Bound">k</a> <a id="1588" class="Symbol">(</a><a id="1589" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1593" href="Examples.Gcd.Clocked.html#1415" class="Bound">y</a> <a id="1595" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1597" href="Examples.Gcd.Clocked.html#1491" class="Bound">z</a> <a id="1599" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1601" href="Examples.Gcd.Clocked.html#1509" class="Bound">h2</a><a id="1603" class="Symbol">)</a> <a id="1605" class="Symbol">}</a>

<a id="gcd"></a><a id="1608" href="Examples.Gcd.Clocked.html#1608" class="Function">gcd</a> <a id="1612" class="Symbol">:</a> <a id="1614" href="Calf.Metalanguage.html#506" class="Function">cmp</a> <a id="1618" class="Symbol">(</a><a id="1619" href="Calf.Metalanguage.html#1035" class="Function">Π</a> <a id="1621" href="Examples.Gcd.Euclid.html#1349" class="Function">gcd/i</a> <a id="1627" class="Symbol">λ</a> <a id="1629" href="Examples.Gcd.Clocked.html#1629" class="Bound">_</a> <a id="1631" class="Symbol">→</a> <a id="1633" href="Calf.Metalanguage.html#311" class="Function">F</a> <a id="1635" href="Calf.Types.Nat.html#164" class="Function">nat</a><a id="1638" class="Symbol">)</a>
<a id="1640" href="Examples.Gcd.Clocked.html#1608" class="Function">gcd</a> <a id="1644" href="Examples.Gcd.Clocked.html#1644" class="Bound">i</a> <a id="1646" class="Symbol">=</a> <a id="1648" href="Examples.Gcd.Clocked.html#1250" class="Function">gcd/clocked</a> <a id="1660" class="Symbol">(</a><a id="1661" href="Examples.Gcd.Euclid.html#1419" class="Function">gcd/depth</a> <a id="1671" href="Examples.Gcd.Clocked.html#1644" class="Bound">i</a><a id="1672" class="Symbol">)</a> <a id="1674" href="Examples.Gcd.Clocked.html#1644" class="Bound">i</a>

<a id="1677" class="Comment">-- cost of clocked gcd is bounded by for any (not necessarily safe)</a>
<a id="1745" class="Comment">-- instantiation of the clock</a>
<a id="gcd/clocked≤gcd/depth"></a><a id="1775" href="Examples.Gcd.Clocked.html#1775" class="Function">gcd/clocked≤gcd/depth</a> <a id="1797" class="Symbol">:</a> <a id="1799" class="Symbol">∀</a> <a id="1801" href="Examples.Gcd.Clocked.html#1801" class="Bound">k</a> <a id="1803" href="Examples.Gcd.Clocked.html#1803" class="Bound">i</a> <a id="1805" class="Symbol">→</a> <a id="1807" href="Calf.Types.Bounded.html#462" class="Record">IsBounded</a> <a id="1817" href="Calf.Types.Nat.html#164" class="Function">nat</a> <a id="1821" class="Symbol">(</a><a id="1822" href="Examples.Gcd.Clocked.html#1250" class="Function">gcd/clocked</a> <a id="1834" href="Examples.Gcd.Clocked.html#1801" class="Bound">k</a> <a id="1836" href="Examples.Gcd.Clocked.html#1803" class="Bound">i</a><a id="1837" class="Symbol">)</a> <a id="1839" class="Symbol">(</a><a id="1840" href="Examples.Gcd.Euclid.html#1419" class="Function">gcd/depth</a> <a id="1850" href="Examples.Gcd.Clocked.html#1803" class="Bound">i</a><a id="1851" class="Symbol">)</a>
<a id="1853" href="Examples.Gcd.Clocked.html#1775" class="Function">gcd/clocked≤gcd/depth</a> <a id="1875" href="Agda.Builtin.Nat.html#204" class="InductiveConstructor">zero</a> <a id="1880" href="Examples.Gcd.Clocked.html#1880" class="Bound">i</a> <a id="1882" class="Symbol">=</a> <a id="1884" href="Calf.Types.Bounded.html#788" class="Function">bound/relax</a> <a id="1896" class="Symbol">(λ</a> <a id="1899" href="Examples.Gcd.Clocked.html#1899" class="Bound">_</a> <a id="1901" class="Symbol">→</a> <a id="1903" href="Data.Nat.Base.html#1567" class="InductiveConstructor">z≤n</a><a id="1906" class="Symbol">)</a> <a id="1908" href="Calf.Types.Bounded.html#1228" class="Function">bound/ret</a>
<a id="1918" href="Examples.Gcd.Clocked.html#1775" class="Function">gcd/clocked≤gcd/depth</a> <a id="1940" class="Symbol">(</a><a id="1941" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="1945" href="Examples.Gcd.Clocked.html#1945" class="Bound">k</a><a id="1946" class="Symbol">)</a> <a id="1948" class="Symbol">(</a><a id="1949" href="Examples.Gcd.Clocked.html#1949" class="Bound">x</a> <a id="1951" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1953" href="Agda.Builtin.Nat.html#204" class="InductiveConstructor">zero</a> <a id="1958" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1960" href="Examples.Gcd.Clocked.html#1960" class="Bound">h</a><a id="1961" class="Symbol">)</a> <a id="1963" class="Symbol">=</a> <a id="1965" href="Calf.Types.Bounded.html#1228" class="Function">bound/ret</a>
<a id="1975" href="Examples.Gcd.Clocked.html#1775" class="Function">gcd/clocked≤gcd/depth</a> <a id="1997" class="Symbol">(</a><a id="1998" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="2002" href="Examples.Gcd.Clocked.html#2002" class="Bound">k</a><a id="2003" class="Symbol">)</a> <a id="2005" class="Symbol">(</a><a id="2006" href="Examples.Gcd.Clocked.html#2006" class="Bound">x</a> <a id="2008" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2010" href="Examples.Gcd.Clocked.html#2010" class="Bound">y</a><a id="2011" class="Symbol">@(</a><a id="2013" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="2017" class="Symbol">_)</a> <a id="2020" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2022" href="Examples.Gcd.Clocked.html#2022" class="Bound">h</a><a id="2023" class="Symbol">)</a> <a id="2025" class="Keyword">rewrite</a> <a id="2033" href="Examples.Gcd.Euclid.html#2834" class="Function">gcd/depth-unfold-suc</a> <a id="2054" class="Symbol">{</a><a id="2055" class="Argument">h</a> <a id="2057" class="Symbol">=</a> <a id="2059" href="Examples.Gcd.Clocked.html#2022" class="Bound">h</a><a id="2060" class="Symbol">}</a> <a id="2062" class="Symbol">=</a>
  <a id="2066" href="Calf.Types.Bounded.html#1376" class="Function">bound/step</a> <a id="2077" class="Number">1</a> <a id="2079" class="Symbol">_</a> <a id="2081" class="Symbol">(</a><a id="2082" href="Examples.Gcd.Clocked.html#1775" class="Function">gcd/clocked≤gcd/depth</a> <a id="2104" href="Examples.Gcd.Clocked.html#2002" class="Bound">k</a> <a id="2106" class="Symbol">(</a><a id="2107" href="Examples.Gcd.Clocked.html#2010" class="Bound">y</a> <a id="2109" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2111" href="Examples.Gcd.Clocked.html#2006" class="Bound">x</a> <a id="2113" href="Data.Nat.Base.html#5269" class="Function Operator">%</a> <a id="2115" href="Examples.Gcd.Clocked.html#2010" class="Bound">y</a> <a id="2117" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2119" href="Data.Nat.DivMod.html#3989" class="Function">m%n&lt;n</a> <a id="2125" href="Examples.Gcd.Clocked.html#2006" class="Bound">x</a> <a id="2127" class="Symbol">_))</a>

<a id="gcd≤gcd/depth"></a><a id="2132" href="Examples.Gcd.Clocked.html#2132" class="Function">gcd≤gcd/depth</a> <a id="2146" class="Symbol">:</a> <a id="2148" class="Symbol">∀</a> <a id="2150" href="Examples.Gcd.Clocked.html#2150" class="Bound">i</a> <a id="2152" class="Symbol">→</a> <a id="2154" href="Calf.Types.Bounded.html#462" class="Record">IsBounded</a> <a id="2164" href="Calf.Types.Nat.html#164" class="Function">nat</a> <a id="2168" class="Symbol">(</a><a id="2169" href="Examples.Gcd.Clocked.html#1608" class="Function">gcd</a> <a id="2173" href="Examples.Gcd.Clocked.html#2150" class="Bound">i</a><a id="2174" class="Symbol">)</a> <a id="2176" class="Symbol">(</a><a id="2177" href="Examples.Gcd.Euclid.html#1419" class="Function">gcd/depth</a> <a id="2187" href="Examples.Gcd.Clocked.html#2150" class="Bound">i</a><a id="2188" class="Symbol">)</a>
<a id="2190" href="Examples.Gcd.Clocked.html#2132" class="Function">gcd≤gcd/depth</a> <a id="2204" href="Examples.Gcd.Clocked.html#2204" class="Bound">i</a> <a id="2206" class="Symbol">=</a> <a id="2208" href="Examples.Gcd.Clocked.html#1775" class="Function">gcd/clocked≤gcd/depth</a> <a id="2230" class="Symbol">(</a><a id="2231" href="Examples.Gcd.Euclid.html#1419" class="Function">gcd/depth</a> <a id="2241" href="Examples.Gcd.Clocked.html#2204" class="Bound">i</a><a id="2242" class="Symbol">)</a> <a id="2244" href="Examples.Gcd.Clocked.html#2204" class="Bound">i</a>

<a id="gcd/bounded"></a><a id="2247" href="Examples.Gcd.Clocked.html#2247" class="Function">gcd/bounded</a> <a id="2259" class="Symbol">:</a> <a id="2261" href="Calf.Metalanguage.html#506" class="Function">cmp</a> <a id="2265" class="Symbol">(</a><a id="2266" href="Calf.Types.BoundedFunction.html#435" class="Function">Ψ</a> <a id="2268" href="Examples.Gcd.Euclid.html#1349" class="Function">gcd/i</a> <a id="2274" class="Symbol">(λ</a> <a id="2277" class="Symbol">{</a> <a id="2279" class="Symbol">_</a> <a id="2281" class="Symbol">→</a> <a id="2283" href="Calf.Types.Nat.html#164" class="Function">nat</a> <a id="2287" class="Symbol">})</a> <a id="2290" href="Examples.Gcd.Euclid.html#1419" class="Function">gcd/depth</a><a id="2299" class="Symbol">)</a>
<a id="2301" href="Examples.Gcd.Clocked.html#2247" class="Function">gcd/bounded</a> <a id="2313" class="Symbol">=</a> <a id="2315" href="Examples.Gcd.Clocked.html#1608" class="Function">gcd</a> <a id="2319" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2321" href="Examples.Gcd.Clocked.html#2132" class="Function">gcd≤gcd/depth</a>
</pre></body></html>